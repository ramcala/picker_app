<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packer App - Order Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 100%;
            background: white;
        }

        /* ===== LOGIN PAGE ===== */
        .login-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-left {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 40px;
        }

        .login-left h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .login-left p {
            font-size: 18px;
            opacity: 0.9;
            line-height: 1.6;
        }

        .login-form {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            background: white;
        }

        .login-box {
            width: 100%;
            max-width: 400px;
        }

        .login-box h2 {
            font-size: 28px;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .error-message {
            color: #d32f2f;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .toggle-form {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .toggle-form a {
            color: #667eea;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
        }

        /* ===== DASHBOARD ===== */
        .dashboard {
            display: none;
            height: 100vh;
            display: flex;
            background: #f5f5f5;
        }

        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            position: sticky;
            top: 0;
            height: 100vh;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 15px;
        }

        .sidebar h3 {
            font-size: 18px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 0;
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .page-title h1 {
            font-size: 32px;
            color: #333;
            margin: 0;
        }

        .page-title p {
            color: #999;
            font-size: 14px;
            margin-top: 5px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .user-dropdown {
            position: relative;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            min-width: 200px;
            z-index: 1000;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            display: block;
            padding: 12px 20px;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.3s;
        }

        .dropdown-item:hover {
            background: #f5f5f5;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        /* ===== STATS CARDS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid #667eea;
        }

        .stat-card.warning {
            border-left-color: #ff9800;
        }

        .stat-card.success {
            border-left-color: #4caf50;
        }

        .stat-card.danger {
            border-left-color: #f44336;
        }

        .stat-label {
            color: #999;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #333;
        }

        .stat-change {
            font-size: 12px;
            color: #4caf50;
            margin-top: 8px;
        }

        /* ===== ORDERS TABLE ===== */
        .content-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .card-header {
            padding: 20px 30px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            font-size: 18px;
            color: #333;
        }

        .search-box {
            position: relative;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .card-body {
            padding: 20px 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f5f5f5;
        }

        th {
            padding: 15px;
            text-align: left;
            color: #666;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 1px solid #ddd;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            color: #333;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-in-progress {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .action-btn-primary {
            background: #667eea;
            color: white;
        }

        .action-btn-primary:hover {
            background: #5568d3;
        }

        .action-btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .action-btn-secondary:hover {
            background: #d0d0d0;
        }

        /* ===== ORDER DETAIL PAGE ===== */
        .order-detail {
            display: none;
        }

        .order-header {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-info h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }

        .order-info p {
            color: #999;
            font-size: 14px;
        }

        .order-items {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .order-items h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 20px;
        }

        .item-list {
            list-style: none;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
        }

        .item-row:last-child {
            border-bottom: none;
        }

        .item-name {
            flex: 1;
            font-weight: 500;
            color: #333;
        }

        .item-qty {
            margin: 0 20px;
            text-align: right;
            min-width: 80px;
        }

        .item-qty label {
            display: block;
            font-size: 12px;
            color: #999;
        }

        .item-qty input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-buttons .btn {
            flex: 1;
        }

        /* ===== PICKING INTERFACE ===== */
        .picking-interface {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .picking-order-info {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .picking-items {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .picking-item {
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .picking-item:hover {
            border-color: #667eea;
            background: #f8f8ff;
        }

        .picking-item.picked {
            border-color: #4caf50;
            background: #f1f8f6;
        }

        .picking-item-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .picking-item-qty {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .picking-item-qty input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .picking-item-qty .btn-small {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .picking-interface {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .login-container {
                flex-direction: column;
            }

            .login-left {
                padding: 20px;
                text-align: center;
            }

            .login-left h1 {
                font-size: 32px;
            }

            .sidebar {
                width: 100%;
                max-height: 200px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .top-bar {
                flex-direction: column;
                gap: 15px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px;
            }
        }

        /* ===== ANIMATIONS ===== */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-content {
            animation: slideIn 0.3s ease;
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    {# Inject backend-provided API base URL for frontend JS #}
    <meta name="api-base-url" content="{{ api_base_url }}">
    <script>window.__API_BASE_URL__ = "{{ api_base_url }}";</script>
    <!-- ===== LOGIN PAGE ===== -->
    <div id="loginPage" class="login-container">
        <div class="login-left">
            <div>
                <h1>üì¶ Packer App</h1>
                <p>Efficient order picking and packing management system.</p>
                <p style="margin-top: 20px; opacity: 0.8;">Secure authentication, real-time tracking, and seamless workflow management for warehouse operations.</p>
            </div>
        </div>

        <div class="login-form">
            <div class="login-box">
                <h2>Welcome Back</h2>
                
                <div id="loginTab">
                    <form id="loginForm" onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label for="loginUsername">Username</label>
                            <input type="text" id="loginUsername" placeholder="Enter your username" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" placeholder="Enter your password" required>
                        </div>
                        <div id="loginError" class="error-message"></div>
                        <button type="submit" class="btn btn-primary">Sign In</button>
                    </form>
                </div>

                <div id="registerTab" style="display: none;">
                    <form id="registerForm" onsubmit="handleRegister(event)">
                        <div class="form-group">
                            <label for="regUsername">Username</label>
                            <input type="text" id="regUsername" placeholder="Choose a username" required>
                        </div>
                        <div class="form-group">
                            <label for="regPassword">Password</label>
                            <input type="password" id="regPassword" placeholder="Create a password" required>
                        </div>
                        <div class="form-group">
                            <label for="regFullName">Full Name</label>
                            <input type="text" id="regFullName" placeholder="Your full name">
                        </div>
                        <div class="form-group">
                            <label for="regEmail">Email</label>
                            <input type="email" id="regEmail" placeholder="Your email">
                        </div>
                        <div class="form-group">
                            <label for="regPhone">Phone</label>
                            <input type="tel" id="regPhone" placeholder="Your phone number">
                        </div>
                        <div id="registerError" class="error-message"></div>
                        <button type="submit" class="btn btn-primary">Create Account</button>
                    </form>
                </div>

                <div class="toggle-form">
                    <span id="loginToggle">Don't have an account? <a onclick="toggleTab()">Register</a></span>
                    <span id="registerToggle" style="display: none;">Already have an account? <a onclick="toggleTab()">Login</a></span>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== DASHBOARD ===== -->
    <div id="dashboardPage" class="dashboard">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üì¶</div>
                <h3>Packer App</h3>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" onclick="switchPage('dashboard')">
                        <div class="nav-icon">üìä</div>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="switchPage('orders')">
                        <div class="nav-icon">üìã</div>
                        Orders
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="switchPage('picking')">
                        <div class="nav-icon">‚úã</div>
                        Picking
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="switchPage('inventory')">
                        <div class="nav-icon">üì¶</div>
                        Inventory
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="switchPage('profile')">
                        <div class="nav-icon">üë§</div>
                        Profile
                    </a>
                </li>
            </ul>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content" id="mainContent">
            <div class="top-bar">
                <div class="page-title">
                    <h1 id="pageTitle">Dashboard</h1>
                    <p id="pageSubtitle">Welcome back</p>
                </div>
                <div class="user-menu">
                    <div class="user-dropdown">
                        <div class="user-avatar" onclick="toggleUserDropdown()">
                            <span id="userInitial">A</span>
                        </div>
                        <div id="userDropdown" class="dropdown-menu">
                            <a class="dropdown-item" onclick="switchPage('profile')">üë§ Profile</a>
                            <a class="dropdown-item" onclick="logout()">üö™ Logout</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DASHBOARD PAGE -->
            <div id="dashboardContent" class="page-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Pending Orders</div>
                        <div class="stat-value" id="statPending">0</div>
                        <div class="stat-change">Orders waiting to be picked</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">In Progress</div>
                        <div class="stat-value" id="statInProgress">0</div>
                        <div class="stat-change">Currently being picked</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-label">Completed Today</div>
                        <div class="stat-value" id="statCompleted">0</div>
                        <div class="stat-change">+0% from yesterday</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-label">Total Inventory</div>
                        <div class="stat-value" id="statInventory">0</div>
                        <div class="stat-change">Items in stock</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3>Recent Orders</h3>
                    </div>
                    <div class="card-body">
                        <table id="recentOrdersTable">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Reference</th>
                                    <th>Customer</th>
                                    <th>Status</th>
                                    <th>Picking Status</th>
                                    <th>Amount</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="recentOrdersBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; color: #999;">Loading orders...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ORDERS PAGE -->
            <div id="ordersContent" class="page-content" style="display: none;">
                <div class="content-card">
                    <div class="card-header">
                        <h3>All Orders</h3>
                        <div class="search-box">
                            <div class="search-icon">üîç</div>
                            <input type="text" id="orderSearch" placeholder="Search orders..." onkeyup="filterOrders()">
                        </div>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Reference</th>
                                    <th>Customer</th>
                                    <th>Status</th>
                                    <th>Picking Status</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <tr>
                                    <td colspan="8" style="text-align: center; color: #999;">Loading orders...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- PICKING PAGE -->
            <div id="pickingContent" class="page-content" style="display: none;">
                <div class="picking-interface">
                    <div class="picking-order-info">
                        <h3>Order Details</h3>
                        <div id="pickingOrderInfo">
                            <p style="color: #999; text-align: center; padding: 40px 20px;">Select an order to start picking</p>
                        </div>
                    </div>

                    <div class="picking-items">
                        <h3>Items to Pick</h3>
                        <div id="pickingItemsList">
                            <p style="color: #999; text-align: center; padding: 40px 20px;">Items will appear here</p>
                        </div>
                    </div>
                </div>

                <div class="content-card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h3>Available Orders</h3>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Reference</th>
                                    <th>Customer</th>
                                    <th>Items</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="pickingOrdersBody">
                                <tr>
                                    <td colspan="5" style="text-align: center; color: #999;">Loading orders...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- INVENTORY PAGE -->
            <div id="inventoryContent" class="page-content" style="display: none;">
                <div class="content-card">
                    <div class="card-header">
                        <h3>Inventory Stock</h3>
                        <div class="search-box">
                            <div class="search-icon">üîç</div>
                            <input type="text" id="inventorySearch" placeholder="Search products..." onkeyup="filterInventory()">
                        </div>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Product ID</th>
                                    <th>Product Name</th>
                                    <th>Store ID</th>
                                    <th>Stock</th>
                                    <th>MRP</th>
                                    <th>Status</th>
                                    <th>Updated</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; color: #999;">Loading inventory...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- PROFILE PAGE -->
            <div id="profileContent" class="page-content" style="display: none;">
                <div class="content-card" style="max-width: 600px;">
                    <div class="card-header">
                        <h3>Agent Profile</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="profileUsername" disabled>
                        </div>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="profileFullName">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="profileEmail">
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="profilePhone">
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <input type="text" id="profileStatus" disabled>
                        </div>
                        <div class="form-group">
                            <label>Member Since</label>
                            <input type="text" id="profileCreatedAt" disabled>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="switchPage('dashboard')">Cancel</button>
                            <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== API Configuration =====
        // Determine API base URL dynamically:
        // Priority:
        // 1) <meta name="api-base-url" content="..."> set by backend templates
        // 2) window.__API_BASE_URL__ (a global injected by server)
        // 3) fallback to current origin + '/api/v1'
        const DEFAULT_API_PATH = '/api/v1';
        const metaApi = document.querySelector('meta[name="api-base-url"]');
        const API_BASE_URL = metaApi?.content || window.__API_BASE_URL__ || (window.location.origin + DEFAULT_API_PATH);
        let token = null;
        let currentUser = null;
        let currentPage = 'login';

        // ===== Authentication =====
        function toggleTab() {
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const loginToggle = document.getElementById('loginToggle');
            const registerToggle = document.getElementById('registerToggle');

            loginTab.style.display = loginTab.style.display === 'none' ? 'block' : 'none';
            registerTab.style.display = registerTab.style.display === 'none' ? 'block' : 'none';
            loginToggle.style.display = loginToggle.style.display === 'none' ? 'block' : 'none';
            registerToggle.style.display = registerToggle.style.display === 'none' ? 'block' : 'none';
        }

        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            errorDiv.style.display = 'none';

            try {
                const formData = new FormData();
                formData.append('username', username);
                formData.append('password', password);

                const response = await fetch(`${API_BASE_URL}/agents/login`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Invalid credentials');
                }

                const data = await response.json();
                token = data.access_token;
                currentUser = data.agent;
                localStorage.setItem('token', token);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                showDashboard();
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const fullName = document.getElementById('regFullName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const errorDiv = document.getElementById('registerError');
            errorDiv.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/agents/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username,
                        password,
                        full_name: fullName,
                        email,
                        phone
                    })
                });

                if (!response.ok) {
                    throw new Error('Registration failed');
                }

                alert('Registration successful! Please login.');
                toggleTab();
                document.getElementById('registerForm').reset();
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        }

        function logout() {
            token = null;
            currentUser = null;
            localStorage.removeItem('token');
            localStorage.removeItem('currentUser');
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('loginForm').reset();
        }

        function showDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'flex';
            currentPage = 'dashboard';
            switchPage('dashboard');
            
            const initials = currentUser.username.substring(0, 2).toUpperCase();
            document.getElementById('userInitial').textContent = initials;
            
            loadDashboardData();
        }

        // ===== Navigation =====
        function switchPage(page) {
            currentPage = page;
            
            // Hide all pages
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('ordersContent').style.display = 'none';
            document.getElementById('pickingContent').style.display = 'none';
            document.getElementById('inventoryContent').style.display = 'none';
            document.getElementById('profileContent').style.display = 'none';
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected page
            const pageMap = {
                'dashboard': 'dashboardContent',
                'orders': 'ordersContent',
                'picking': 'pickingContent',
                'inventory': 'inventoryContent',
                'profile': 'profileContent'
            };
            
            const titleMap = {
                'dashboard': { title: 'Dashboard', subtitle: 'Welcome back' },
                'orders': { title: 'Orders', subtitle: 'Manage and track orders' },
                'picking': { title: 'Picking', subtitle: 'Pick items for orders' },
                'inventory': { title: 'Inventory', subtitle: 'View stock levels' },
                'profile': { title: 'Profile', subtitle: 'Manage your account' }
            };
            
            document.getElementById(pageMap[page]).style.display = 'block';
            document.getElementById('pageTitle').textContent = titleMap[page].title;
            document.getElementById('pageSubtitle').textContent = titleMap[page].subtitle;
            
            // Add active class to clicked nav item
            event.target.closest('.nav-link').classList.add('active');
            
            // Load page-specific data
            if (page === 'orders') loadOrders();
            else if (page === 'picking') loadPickingOrders();
            else if (page === 'inventory') loadInventory();
            else if (page === 'profile') loadProfile();
        }

        // ===== Dashboard Data =====
        async function loadDashboardData() {
            try {
                const response = await fetch(`${API_BASE_URL}/orders`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error('Failed to load orders');

                const orders = await response.json();
                
                let pending = 0, inProgress = 0, completed = 0;
                
                orders.forEach(order => {
                    if (order.status === 'PENDING') pending++;
                    else if (order.picking_status === 'IN_PROGRESS') inProgress++;
                    else if (order.status === 'PACKED') completed++;
                });

                document.getElementById('statPending').textContent = pending;
                document.getElementById('statInProgress').textContent = inProgress;
                document.getElementById('statCompleted').textContent = completed;
                document.getElementById('statInventory').textContent = '..';

                // Load recent orders
                const tbody = document.getElementById('recentOrdersBody');
                tbody.innerHTML = '';
                
                orders.slice(0, 5).forEach(order => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.order_id}</td>
                        <td>${order.reference_number}</td>
                        <td>${order.customer_id}</td>
                        <td><span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span></td>
                        <td><span class="status-badge status-${order.picking_status.toLowerCase()}">${order.picking_status}</span></td>
                        <td>‚Çπ${order.amount || 0}</td>
                        <td><button class="action-btn action-btn-primary" onclick="loadOrder(${order.id})">View</button></td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // ===== Orders =====
        async function loadOrders() {
            try {
                const response = await fetch(`${API_BASE_URL}/orders`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error('Failed to load orders');

                const orders = await response.json();
                const tbody = document.getElementById('ordersTableBody');
                tbody.innerHTML = '';
                
                orders.forEach(order => {
                    const row = document.createElement('tr');
                    const date = new Date(order.created_at).toLocaleDateString();
                    row.innerHTML = `
                        <td>${order.order_id}</td>
                        <td>${order.reference_number}</td>
                        <td>${order.customer_id}</td>
                        <td><span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span></td>
                        <td><span class="status-badge status-${order.picking_status.toLowerCase()}">${order.picking_status}</span></td>
                        <td>‚Çπ${order.amount || 0}</td>
                        <td>${date}</td>
                        <td>
                            <button class="action-btn action-btn-primary" onclick="loadOrder(${order.id})">Pick</button>
                            <button class="action-btn action-btn-secondary" onclick="viewOrderDetails(${order.id})">Details</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        async function loadPickingOrders() {
            try {
                const response = await fetch(`${API_BASE_URL}/orders?status=PENDING`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error('Failed to load orders');

                const orders = await response.json();
                const tbody = document.getElementById('pickingOrdersBody');
                tbody.innerHTML = '';
                
                orders.forEach(order => {
                    const itemCount = order.items ? order.items.length : 0;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.order_id}</td>
                        <td>${order.reference_number}</td>
                        <td>${order.customer_id}</td>
                        <td>${itemCount} items</td>
                        <td>
                            <button class="action-btn action-btn-primary" onclick="startPicking(${order.id})">Start Picking</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading picking orders:', error);
            }
        }

        async function startPicking(orderId) {
            try {
                const response = await fetch(`${API_BASE_URL}/orders/${orderId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error('Failed to load order');

                const order = await response.json();
                
                // Display order info
                const orderInfo = document.getElementById('pickingOrderInfo');
                orderInfo.innerHTML = `
                    <p><strong>Order ID:</strong> ${order.order_id}</p>
                    <p><strong>Reference:</strong> ${order.reference_number}</p>
                    <p><strong>Customer:</strong> ${order.customer_id}</p>
                    <p><strong>Amount:</strong> ‚Çπ${order.amount || 0}</p>
                    <hr>
                    <div class="action-buttons" style="margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="completePickingOrder(${order.id})">Complete Picking</button>
                    </div>
                `;
                
                // Display items
                const itemsList = document.getElementById('pickingItemsList');
                itemsList.innerHTML = '';
                
                if (order.items && order.items.length > 0) {
                    order.items.forEach((item, index) => {
                        const div = document.createElement('div');
                        div.className = 'picking-item';
                        div.innerHTML = `
                            <div class="picking-item-name">Item ${index + 1}: Product ${item.product_id}</div>
                            <div class="picking-item-qty">
                                <span>Qty: ${item.ordered_quantity}</span>
                                <input type="number" placeholder="Picked qty" value="${item.picked_quantity || 0}" onchange="updatePickedQty(${item.id}, this.value)">
                                <button class="btn-small" onclick="markItemPicked(${item.id})">‚úì Picked</button>
                            </div>
                        `;
                        itemsList.appendChild(div);
                    });
                }
            } catch (error) {
                console.error('Error starting picking:', error);
            }
        }

        async function completePickingOrder(orderId) {
            try {
                const response = await fetch(`${API_BASE_URL}/picking/complete`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        order_id: orderId,
                        crates: []
                    })
                });

                if (!response.ok) throw new Error('Failed to complete picking');

                alert('Order picking completed!');
                loadPickingOrders();
            } catch (error) {
                console.error('Error completing picking:', error);
                alert('Error: ' + error.message);
            }
        }

        // ===== Inventory =====
        async function loadInventory() {
            try {
                const response = await fetch(`${API_BASE_URL}/products`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error('Failed to load inventory');

                const products = await response.json();
                const tbody = document.getElementById('inventoryTableBody');
                tbody.innerHTML = '';
                
                products.forEach(product => {
                    const row = document.createElement('tr');
                    const date = new Date(product.updated_at).toLocaleDateString();
                    row.innerHTML = `
                        <td>${product.product_id}</td>
                        <td>${product.name}</td>
                        <td>-</td>
                        <td>-</td>
                        <td>‚Çπ${product.average_rating || 0}</td>
                        <td><span class="status-badge status-completed">${product.status}</span></td>
                        <td>${date}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading inventory:', error);
            }
        }

        // ===== Profile =====
        async function loadProfile() {
            document.getElementById('profileUsername').value = currentUser.username;
            document.getElementById('profileFullName').value = currentUser.full_name || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
            document.getElementById('profilePhone').value = currentUser.phone || '';
            document.getElementById('profileStatus').value = currentUser.status || 'ACTIVE';
            document.getElementById('profileCreatedAt').value = new Date(currentUser.created_at).toLocaleDateString();
        }

        function saveProfile() {
            alert('Profile update feature coming soon!');
        }

        // ===== Helper Functions =====
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        function filterOrders() {
            const search = document.getElementById('orderSearch').value.toLowerCase();
            document.querySelectorAll('#ordersTableBody tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        function filterInventory() {
            const search = document.getElementById('inventorySearch').value.toLowerCase();
            document.querySelectorAll('#inventoryTableBody tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        // ===== Initialize =====
        window.addEventListener('load', () => {
            const savedToken = localStorage.getItem('token');
            const savedUser = localStorage.getItem('currentUser');
            
            if (savedToken && savedUser) {
                token = savedToken;
                currentUser = JSON.parse(savedUser);
                showDashboard();
            } else {
                // Always show login page if not authenticated
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('dashboardPage').style.display = 'none';
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('userDropdown');
            if (!e.target.closest('.user-dropdown')) {
                dropdown.classList.remove('show');
            }
        });
    </script>
</body>
</html>
